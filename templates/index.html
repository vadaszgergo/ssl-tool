<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SSL Certificate Tools</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Inter:wght@500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #0f766e;
            --primary-strong: #0d9488;
            --accent: #f97316;
            --bg-1: #e9f1ff;
            --bg-2: #d1f2e6;
            --text-1: #0f172a;
            --text-2: #334155;
            --panel: rgba(255, 255, 255, 0.9);
            --panel-border: rgba(15, 118, 110, 0.08);
            --muted-border: rgba(15, 23, 42, 0.08);
            --shadow: 0 30px 90px rgba(15, 23, 42, 0.12);
            --input: rgba(255, 255, 255, 0.75);
            --input-border: rgba(15, 23, 42, 0.08);
            --input-focus: rgba(15, 118, 110, 0.4);
            --tab-bg: rgba(255, 255, 255, 0.65);
            --tab-active: rgba(15, 118, 110, 0.08);
            --success-bg: #ecfdf3;
            --success-border: #10b981;
            --success-text: #0f5132;
            --error-bg: #fef2f2;
            --error-border: #ef4444;
            --error-text: #7f1d1d;
            --warning-bg: #fff7ed;
            --warning-border: #f97316;
            --warning-text: #7c2d12;
        }

        [data-theme="dark"] {
            --primary: #5eead4;
            --primary-strong: #2dd4bf;
            --accent: #fb923c;
            --bg-1: #0b1727;
            --bg-2: #102235;
            --text-1: #e2e8f0;
            --text-2: #94a3b8;
            --panel: rgba(16, 34, 53, 0.75);
            --panel-border: rgba(94, 234, 212, 0.1);
            --muted-border: rgba(148, 163, 184, 0.16);
            --shadow: 0 30px 90px rgba(0, 0, 0, 0.5);
            --input: rgba(14, 23, 42, 0.65);
            --input-border: rgba(148, 163, 184, 0.25);
            --input-focus: rgba(94, 234, 212, 0.35);
            --tab-bg: rgba(15, 23, 42, 0.75);
            --tab-active: rgba(94, 234, 212, 0.08);
            --success-bg: #0f3d32;
            --success-border: #34d399;
            --success-text: #d1fae5;
            --error-bg: #2a1313;
            --error-border: #f87171;
            --error-text: #fecdd3;
            --warning-bg: #2c1b0f;
            --warning-border: #fb923c;
            --warning-text: #fed7aa;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Space Grotesk', 'Inter', system-ui, -apple-system, 'Segoe UI', sans-serif;
            background: radial-gradient(circle at 20% 20%, var(--bg-1), transparent 40%),
                        radial-gradient(circle at 80% 0%, var(--bg-2), transparent 40%),
                        linear-gradient(135deg, var(--bg-1), var(--bg-2));
            color: var(--text-1);
            min-height: 100vh;
            padding: 32px 20px 40px;
            position: relative;
            overflow-x: hidden;
        }

        .grid-blob {
            position: absolute;
            width: 520px;
            height: 520px;
            border-radius: 999px;
            filter: blur(120px);
            opacity: 0.35;
            z-index: 0;
            pointer-events: none;
        }

        .blob-1 { background: #0ea5e9; top: -120px; left: -120px; }
        .blob-2 { background: #22c55e; top: 40%; right: -160px; }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        header.hero {
            display: grid;
            grid-template-columns: 1fr auto;
            align-items: center;
            gap: 20px;
            margin-bottom: 24px;
        }

        .hero-title {
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--text-1);
            font-weight: 700;
            letter-spacing: -0.02em;
            font-size: 32px;
        }

        .eyebrow {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: var(--text-2);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .hero-copy {
            color: var(--text-2);
            max-width: 780px;
            line-height: 1.6;
            margin-top: 8px;
        }

        .pill-row {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 16px;
        }

        .pill {
            background: var(--tab-bg);
            border: 1px solid var(--panel-border);
            color: var(--text-1);
            padding: 8px 12px;
            border-radius: 999px;
            font-size: 13px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .theme-toggle {
            background: var(--panel);
            border: 1px solid var(--panel-border);
            border-radius: 999px;
            padding: 10px 16px;
            cursor: pointer;
            font-size: 16px;
            color: var(--text-1);
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            box-shadow: var(--shadow);
        }

        .theme-toggle:hover { transform: translateY(-1px) scale(1.01); border-color: var(--primary); }

        .surface {
            background: var(--panel);
            border: 1px solid var(--panel-border);
            border-radius: 20px;
            box-shadow: var(--shadow);
            overflow: hidden;
            backdrop-filter: blur(14px);
        }

        .tabs-nav {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 8px;
            padding: 14px;
            background: var(--tab-bg);
            overflow-x: auto;
            scrollbar-width: thin;
            scrollbar-color: var(--primary) transparent;
        }

        .tabs-nav::-webkit-scrollbar { height: 6px; }
        .tabs-nav::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 99px; }

        .tab-button {
            border: 1px solid var(--muted-border);
            background: transparent;
            color: var(--text-1);
            padding: 12px 14px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            text-align: left;
            transition: all 0.2s ease;
            min-width: 170px;
        }

        .tab-button:hover { border-color: var(--primary); transform: translateY(-1px); }
        .tab-button.active { background: var(--tab-active); border-color: var(--primary); color: var(--primary-strong); box-shadow: inset 0 0 0 1px rgba(15,118,110,0.08); }

        .tab-content { display: none; padding: 24px 24px 28px; }
        .tab-content.active { display: block; }

        h2 {
            font-size: 24px;
            margin-bottom: 8px;
            color: var(--text-1);
            letter-spacing: -0.01em;
        }

        .lede { color: var(--text-2); margin-bottom: 16px; }

        textarea, select, input[type="password"] {
            width: 100%;
            min-height: 140px;
            padding: 14px 16px;
            border: 1px solid var(--input-border);
            border-radius: 12px;
            background: var(--input);
            color: var(--text-1);
            font-family: 'Space Grotesk', 'Inter', monospace;
            font-size: 13px;
            line-height: 1.5;
            resize: vertical;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
            margin-bottom: 14px;
        }

        select, input[type="password"] { min-height: auto; }

        textarea:focus, select:focus, input[type="password"]:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px var(--input-focus);
        }

        label {
            display: block;
            font-weight: 600;
            color: var(--text-1);
            margin-bottom: 6px;
            letter-spacing: -0.01em;
        }

        button {
            background: linear-gradient(135deg, var(--primary), var(--primary-strong));
            color: #0b1c26;
            border: none;
            padding: 14px 22px;
            border-radius: 12px;
            font-size: 15px;
            cursor: pointer;
            font-weight: 700;
            letter-spacing: -0.01em;
            transition: transform 0.15s ease, box-shadow 0.2s ease;
            box-shadow: 0 14px 40px rgba(15, 118, 110, 0.25);
        }

        button:hover { transform: translateY(-1px); box-shadow: 0 16px 42px rgba(15,118,110,0.35); }
        button:active { transform: translateY(0); }

        .result {
            margin-top: 18px;
            padding: 16px;
            border-radius: 14px;
            display: none;
            border: 1px solid transparent;
        }

        .result.success { background: var(--success-bg); border-color: var(--success-border); color: var(--success-text); }
        .result.error { background: var(--error-bg); border-color: var(--error-border); color: var(--error-text); }

        .match-success, .match-failure {
            margin-top: 18px;
            border-radius: 14px;
            padding: 16px;
            font-weight: 700;
            text-align: center;
        }

        .match-success { background: var(--success-bg); border: 1px solid var(--success-border); color: var(--success-text); }
        .match-failure { background: var(--error-bg); border: 1px solid var(--error-border); color: var(--error-text); }

        .warning-box {
            background: var(--warning-bg);
            border: 1px solid var(--warning-border);
            border-radius: 14px;
            padding: 14px 16px;
            margin: 12px 0 18px;
            color: var(--warning-text);
            line-height: 1.5;
        }

        .warning-box strong { display: block; margin-bottom: 6px; color: var(--warning-border); }

        .cli-box {
            background: var(--tab-bg);
            border: 1px dashed var(--muted-border);
            border-radius: 12px;
            padding: 12px 14px;
            margin: 12px 0 18px;
            font-family: 'Space Grotesk', 'Inter', monospace;
            color: var(--text-1);
            font-size: 13px;
        }

        .cli-box strong {
            color: var(--text-2);
            letter-spacing: 0.01em;
            display: block;
            margin-bottom: 6px;
        }

        .cli-box code {
            display: block;
            white-space: pre;
            overflow-x: auto;
            padding: 10px 12px;
            background: rgba(0,0,0,0.05);
            border-radius: 10px;
            border: 1px solid var(--muted-border);
        }

        .copy-button {
            background: linear-gradient(135deg, #0ea5e9, #22d3ee);
            color: #04111a;
            padding: 10px 16px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 700;
            border: none;
            margin-top: 8px;
            box-shadow: 0 10px 26px rgba(14,165,233,0.28);
        }

        .result-textarea {
            width: 100%;
            min-height: 320px;
            padding: 14px;
            border: 1px solid var(--success-border);
            border-radius: 12px;
            font-family: 'Space Grotesk', 'Inter', monospace;
            font-size: 13px;
            line-height: 1.6;
            background: rgba(255,255,255,0.6);
            color: var(--success-text);
            resize: vertical;
            margin-top: 10px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .copy-success {
            display: inline-block;
            margin-left: 10px;
            color: var(--success-border);
            font-weight: 700;
            animation: fadeOut 2s forwards;
        }

        @keyframes fadeOut { 0% { opacity: 1; } 100% { opacity: 0; } }

        footer {
            text-align: center;
            margin-top: 36px;
            padding: 16px;
            color: var(--text-2);
            font-size: 14px;
        }

        footer a { color: var(--primary); text-decoration: underline; }
        footer a:hover { color: var(--primary-strong); }

        .meta-row {
            display: flex;
            gap: 14px;
            flex-wrap: wrap;
            align-items: center;
            margin-bottom: 10px;
        }

        @media (max-width: 900px) {
            header.hero {
                grid-template-columns: 1fr;
                gap: 14px;
            }
            .hero-title { font-size: 26px; }
            body { padding: 22px 14px 30px; }
            .surface { border-radius: 16px; }
        }

        @media (max-width: 680px) {
            .tabs-nav {
                grid-auto-flow: column;
                grid-auto-columns: minmax(200px, 1fr);
                grid-template-columns: none;
            }
            .tab-content { padding: 18px 18px 22px; }
            textarea, select, input[type="password"] { min-height: 120px; font-size: 12px; }
            button { width: 100%; text-align: center; }
            .theme-toggle { justify-self: start; }
        }
    </style>
</head>
<body>
    <div class="grid-blob blob-1"></div>
    <div class="grid-blob blob-2"></div>
    <div class="container">
        <header class="hero">
            <div>
                <span class="eyebrow">SSL toolkit ‚Ä¢ modern UI</span>
                <div class="hero-title">üîí SSL Certificate Tools</div>
                <p class="hero-copy">Decode, validate, and convert certificates with a privacy-first workflow. Everything runs in-memory and can be hosted locally for full control.</p>
                <div class="pill-row">
                    <span class="pill">Zero persistence</span>
                    <span class="pill">CSR, CRT, PFX/P12</span>
                    <span class="pill">Live copy-ready outputs</span>
                </div>
            </div>
            <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle theme">
                <span id="theme-icon">üåô</span>
                <span id="theme-text">Dark mode</span>
            </button>
        </header>
        
        <div class="surface">
            <div class="tabs-nav">
                <button class="tab-button active" onclick="switchTab('cert-decoder', this)">Certificate Decoder</button>
                <button class="tab-button" onclick="switchTab('key-matcher', this)">Certificate & Key Matcher</button>
                <button class="tab-button" onclick="switchTab('csr-decoder', this)">CSR Decoder</button>
                <button class="tab-button" onclick="switchTab('cert-converter', this)">Certificate Converter</button>
            </div>

            <div id="cert-decoder" class="tab-content active">
                <h2>SSL Certificate Decoder</h2>
                <p class="lede">Paste any PEM or DER certificate to see subject, issuer, SAN, validity, and serial details instantly.</p>
                <textarea id="certificate-input" placeholder="Paste your certificate (PEM format) here..."></textarea>
                <button onclick="decodeCertificate()">Decode Certificate</button>
                <div id="certificate-result" class="result"></div>
            </div>

            <div id="key-matcher" class="tab-content">
                <h2>Certificate & Key Matcher</h2>
                <p class="lede">Verify if a private key pairs with a certificate. Outputs a clear yes/no without persisting any material.</p>
                <div class="warning-box">
                    <strong>‚ö†Ô∏è Security Notice</strong>
                    <div>This is for testing only. <strong>Do not paste production private keys</strong>. Use disposable or development keys.</div>
                    <div style="margin-top: 10px;">Run it locally for maximum isolation: <a href="https://hub.docker.com/r/vadaszgergo/ssl-tool" target="_blank">docker image</a></div>
                </div>
                <div class="cli-box">
                    <strong>CLI alternative (local):</strong>
                    <code># Compare modulus (RSA keys)
openssl x509 -noout -modulus -in cert.pem | openssl md5
openssl rsa -noout -modulus -in key.pem  | openssl md5
# Matching hashes mean the pair is valid</code>
                </div>
                <label>Certificate</label>
                <textarea id="match-cert-input" placeholder="Paste certificate here..."></textarea>
                <label>Private Key</label>
                <textarea id="match-key-input" placeholder="Paste private key here..."></textarea>
                <button onclick="checkMatch()">Check Match</button>
                <div id="match-result" class="result"></div>
            </div>

            <div id="csr-decoder" class="tab-content">
                <h2>CSR Decoder</h2>
                <p class="lede">Inspect a Certificate Signing Request to see CN, SAN, key type, and size before submission.</p>
                <textarea id="csr-input" placeholder="Paste your CSR (Certificate Signing Request) here..."></textarea>
                <button onclick="decodeCSR()">Decode CSR</button>
                <div id="csr-result" class="result"></div>
            </div>

            <div id="cert-converter" class="tab-content">
                <h2>Certificate Converter</h2>
                <p class="lede">Flip between PEM, DER/CRT, and PFX/P12. Upload binaries or paste base64. Passwords stay in-memory only.</p>
                <div class="warning-box">
                    <strong>‚ö†Ô∏è Security Notice</strong>
                    <div>Converter may handle private keys when PFX/P12 files are provided. Use non-production material or host locally.</div>
                    <div style="margin-top: 10px;">Self-host: <a href="https://hub.docker.com/r/vadaszgergo/ssl-tool" target="_blank">docker image</a></div>
                </div>
                <label>Input Format</label>
                <select id="convert-input-format">
                    <option value="auto">Auto-detect</option>
                    <option value="pem">PEM</option>
                    <option value="der">DER</option>
                    <option value="crt">CRT</option>
                    <option value="pfx">PFX/P12</option>
                </select>
                <label>Output Format</label>
                <select id="convert-output-format">
                    <option value="pem">PEM</option>
                    <option value="der">DER</option>
                    <option value="crt">CRT</option>
                    <option value="pfx">PFX/P12</option>
                </select>
                <label>Password (for PFX/P12 files)</label>
                <input type="password" id="convert-password" placeholder="Leave empty if not password-protected">
                <label>Certificate Data</label>
                <div style="margin-bottom: 10px;">
                    <input type="file" id="convert-file-input" accept=".pfx,.p12,.pem,.der,.crt,.cer" style="margin-bottom: 10px;">
                    <div style="font-size: 12px; color: var(--text-2); margin-bottom: 10px;">
                        <strong>Base64 hint:</strong> For PFX/P12, convert to base64 first:
                        <br><code style="background: var(--tab-bg); padding: 4px 8px; border-radius: 8px;">base64 -i certificate.pfx | pbcopy</code> (macOS)
                        <br><code style="background: var(--tab-bg); padding: 4px 8px; border-radius: 8px;">base64 certificate.pfx</code> (Linux)
                    </div>
                </div>
                <textarea id="convert-input" placeholder="Paste certificate data here (PEM, DER, CRT, or base64-encoded PFX/P12)..."></textarea>
                <button onclick="convertCertificate()">Convert Certificate</button>
                <div id="convert-result" class="result"></div>
            </div>
        </div>
    </div>

    <script>
        function initTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            setTheme(savedTheme);
        }

        function setTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            const icon = document.getElementById('theme-icon');
            const text = document.getElementById('theme-text');
            
            if (theme === 'dark') {
                icon.textContent = '‚òÄÔ∏è';
                text.textContent = 'Light mode';
            } else {
                icon.textContent = 'üåô';
                text.textContent = 'Dark mode';
            }
            
            localStorage.setItem('theme', theme);
        }

        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            setTheme(newTheme);
        }

        initTheme();

        function switchTab(tabId, buttonElement) {
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => content.classList.remove('active'));

            const tabButtons = document.querySelectorAll('.tab-button');
            tabButtons.forEach(button => button.classList.remove('active'));

            document.getElementById(tabId).classList.add('active');
            buttonElement.classList.add('active');
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        async function decodeCertificate() {
            const certText = document.getElementById('certificate-input').value.trim();
            const resultDiv = document.getElementById('certificate-result');
            
            if (!certText) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = '<h3>Error</h3><p>Please paste a certificate.</p>';
                resultDiv.style.display = 'block';
                return;
            }

            try {
                const response = await fetch('/api/decode-certificate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ certificate: certText })
                });

                const data = await response.json();
                
                if (data.success) {
                    let copyText = 'Certificate Information\n';
                    copyText += '=====================\n\n';
                    copyText += `Common Name: ${data.common_name || 'N/A'}\n`;
                    copyText += `Organization: ${data.organization || 'N/A'}\n`;
                    copyText += `Organizational Unit: ${data.organizational_unit || 'N/A'}\n`;
                    copyText += `Locality: ${data.locality || 'N/A'}\n`;
                    copyText += `State/Province: ${data.state || 'N/A'}\n`;
                    copyText += `Country: ${data.country || 'N/A'}\n`;
                    copyText += `Serial Number: ${data.serial_number || 'N/A'}\n`;
                    copyText += `Valid From: ${data.valid_from || 'N/A'}\n`;
                    copyText += `Valid To: ${data.valid_to || 'N/A'}\n`;
                    copyText += `Issuer CN: ${data.issuer_cn || 'N/A'}\n`;
                    copyText += `Issuer Organization: ${data.issuer_org || 'N/A'}\n`;
                    
                    if (data.san && data.san.length > 0) {
                        copyText += `\nSubject Alternative Names:\n`;
                        data.san.forEach(san => { copyText += `  - ${san}\n`; });
                    } else {
                        copyText += `\nSubject Alternative Names: None\n`;
                    }

                    let html = '<h3>Certificate Information</h3>';
                    html += `<textarea class="result-textarea" id="cert-result-text" readonly>${escapeHtml(copyText)}</textarea>`;
                    html += `<button class="copy-button" onclick="copyToClipboard('cert-result-text', this)">üìã Copy All</button>`;
                    html += '<span class="copy-success" id="cert-copy-success"></span>';
                    
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = html;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = `<h3>Error</h3><p>${data.error || 'Failed to decode certificate'}</p>`;
                }
                resultDiv.style.display = 'block';
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `<h3>Error</h3><p>${error.message}</p>`;
                resultDiv.style.display = 'block';
            }
        }

        async function checkMatch() {
            const certText = document.getElementById('match-cert-input').value.trim();
            const keyText = document.getElementById('match-key-input').value.trim();
            const resultDiv = document.getElementById('match-result');
            
            if (!certText || !keyText) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = '<h3>Error</h3><p>Please paste both certificate and private key.</p>';
                resultDiv.style.display = 'block';
                return;
            }

            try {
                const response = await fetch('/api/check-match', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ certificate: certText, private_key: keyText })
                });

                const data = await response.json();
                
                if (data.success) {
                    if (data.match) {
                        resultDiv.className = 'match-success';
                        resultDiv.innerHTML = '‚úÖ ' + data.message;
                    } else {
                        resultDiv.className = 'match-failure';
                        resultDiv.innerHTML = '‚ùå ' + data.message;
                    }
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = `<h3>Error</h3><p>${data.error || 'Failed to check match'}</p>`;
                }
                resultDiv.style.display = 'block';
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `<h3>Error</h3><p>${error.message}</p>`;
                resultDiv.style.display = 'block';
            }
        }

        async function decodeCSR() {
            const csrText = document.getElementById('csr-input').value.trim();
            const resultDiv = document.getElementById('csr-result');
            
            if (!csrText) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = '<h3>Error</h3><p>Please paste a CSR.</p>';
                resultDiv.style.display = 'block';
                return;
            }

            try {
                const response = await fetch('/api/decode-csr', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ csr: csrText })
                });

                const data = await response.json();
                
                if (data.success) {
                    let copyText = 'CSR Information\n';
                    copyText += '===============\n\n';
                    copyText += `Common Name: ${data.common_name || 'N/A'}\n`;
                    copyText += `Organization: ${data.organization || 'N/A'}\n`;
                    copyText += `Organizational Unit: ${data.organizational_unit || 'N/A'}\n`;
                    copyText += `Locality: ${data.locality || 'N/A'}\n`;
                    copyText += `State/Province: ${data.state || 'N/A'}\n`;
                    copyText += `Country: ${data.country || 'N/A'}\n`;
                    copyText += `Email: ${data.email || 'N/A'}\n`;
                    copyText += `Key Type: ${data.key_type || 'N/A'}\n`;
                    copyText += `Key Size: ${data.key_size ? data.key_size + ' bits' : 'N/A'}\n`;
                    
                    if (data.san && data.san.length > 0) {
                        copyText += `\nSubject Alternative Names:\n`;
                        data.san.forEach(san => { copyText += `  - ${san}\n`; });
                    } else {
                        copyText += `\nSubject Alternative Names: None\n`;
                    }

                    let html = '<h3>CSR Information</h3>';
                    html += `<textarea class="result-textarea" id="csr-result-text" readonly>${escapeHtml(copyText)}</textarea>`;
                    html += `<button class="copy-button" onclick="copyToClipboard('csr-result-text', this)">üìã Copy All</button>`;
                    html += '<span class="copy-success" id="csr-copy-success"></span>';
                    
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = html;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = `<h3>Error</h3><p>${data.error || 'Failed to decode CSR'}</p>`;
                }
                resultDiv.style.display = 'block';
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `<h3>Error</h3><p>${error.message}</p>`;
                resultDiv.style.display = 'block';
            }
        }

        document.getElementById('convert-file-input').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const fileName = file.name.toLowerCase();
            const reader = new FileReader();
            
            reader.onload = function(e) {
                const fileName = file.name.toLowerCase();
                
                if (fileName.endsWith('.pfx') || fileName.endsWith('.p12')) {
                    document.getElementById('convert-input-format').value = 'pfx';
                    const arrayBuffer = e.target.result;
                    const bytes = new Uint8Array(arrayBuffer);
                    let binary = '';
                    for (let i = 0; i < bytes.length; i++) { binary += String.fromCharCode(bytes[i]); }
                    const base64 = btoa(binary);
                    document.getElementById('convert-input').value = base64;
                } else if (fileName.endsWith('.pem')) {
                    document.getElementById('convert-input-format').value = 'pem';
                    document.getElementById('convert-input').value = e.target.result;
                } else if (fileName.endsWith('.der') || fileName.endsWith('.crt') || fileName.endsWith('.cer')) {
                    document.getElementById('convert-input-format').value = 'der';
                    const arrayBuffer = e.target.result;
                    const bytes = new Uint8Array(arrayBuffer);
                    let binary = '';
                    for (let i = 0; i < bytes.length; i++) { binary += String.fromCharCode(bytes[i]); }
                    const base64 = btoa(binary);
                    document.getElementById('convert-input').value = base64;
                } else {
                    const content = e.target.result;
                    if (typeof content === 'string' && content.includes('BEGIN')) {
                        document.getElementById('convert-input-format').value = 'pem';
                        document.getElementById('convert-input').value = content;
                    } else {
                        const arrayBuffer = e.target.result;
                        const bytes = new Uint8Array(arrayBuffer);
                        let binary = '';
                        for (let i = 0; i < bytes.length; i++) { binary += String.fromCharCode(bytes[i]); }
                        const base64 = btoa(binary);
                        document.getElementById('convert-input').value = base64;
                    }
                }
            };
            
            if (fileName.endsWith('.pfx') || fileName.endsWith('.p12') || fileName.endsWith('.der') || fileName.endsWith('.crt') || fileName.endsWith('.cer')) {
                reader.readAsArrayBuffer(file);
            } else {
                reader.readAsText(file);
            }
        });

        async function convertCertificate() {
            const inputData = document.getElementById('convert-input').value.trim();
            const inputFormat = document.getElementById('convert-input-format').value;
            const outputFormat = document.getElementById('convert-output-format').value;
            const password = document.getElementById('convert-password').value;
            const resultDiv = document.getElementById('convert-result');
            
            if (!inputData) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = '<h3>Error</h3><p>Please upload a file or paste certificate data.</p>';
                resultDiv.style.display = 'block';
                return;
            }

            try {
                const response = await fetch('/api/convert-certificate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        input_data: inputData,
                        input_format: inputFormat,
                        output_format: outputFormat,
                        password: password
                    })
                });

                const data = await response.json();
                
                if (data.success) {
                    let html = '<h3>Converted Certificate</h3>';
                    html += `<p><strong>Format:</strong> ${outputFormat.toUpperCase()}</p>`;
                    if (data.has_private_key) {
                        html += '<p><strong>Note:</strong> Private key extracted separately below.</p>';
                    }
                    if (data.has_additional_certs) {
                        html += '<p><strong>Note:</strong> This file contains additional certificates (certificate chain).</p>';
                    }
                    
                    // Certificate output
                    html += '<label style="display: block; margin-top: 15px; margin-bottom: 5px; font-weight: 600;">Certificate:</label>';
                    html += `<textarea class="result-textarea" id="convert-result-text" readonly>${escapeHtml(data.output_data)}</textarea>`;
                    html += `<button class="copy-button" onclick="copyToClipboard('convert-result-text', this)">üìã Copy Certificate</button>`;
                    html += '<span class="copy-success" id="convert-copy-success"></span>';
                    
                    // Private key output (if available)
                    if (data.output_key_data) {
                        html += '<label style="display: block; margin-top: 15px; margin-bottom: 5px; font-weight: 600;">Private Key:</label>';
                        html += `<textarea class="result-textarea" id="convert-key-text" readonly>${escapeHtml(data.output_key_data)}</textarea>`;
                        html += `<button class="copy-button" onclick="copyToClipboard('convert-key-text', this)">üìã Copy Private Key</button>`;
                        html += '<span class="copy-success" id="convert-key-copy-success"></span>';
                    }
                    
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = html;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = `<h3>Error</h3><p>${data.error || 'Failed to convert certificate'}</p>`;
                }
                resultDiv.style.display = 'block';
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `<h3>Error</h3><p>${error.message}</p>`;
                resultDiv.style.display = 'block';
            }
        }

        function copyToClipboard(elementId, button) {
            const textarea = document.getElementById(elementId);
            if (!textarea) return;
            
            textarea.select();
            textarea.setSelectionRange(0, 99999); // For mobile devices
            
            try {
                document.execCommand('copy');
                const successSpan = document.getElementById(elementId.replace('-text', '-copy-success'));
                if (successSpan) {
                    successSpan.textContent = '‚úì Copied!';
                    setTimeout(() => {
                        successSpan.textContent = '';
                    }, 2000);
                }
            } catch (err) {
                // Fallback: use modern Clipboard API
                navigator.clipboard.writeText(textarea.value).then(() => {
                    const successSpan = document.getElementById(elementId.replace('-text', '-copy-success'));
                    if (successSpan) {
                        successSpan.textContent = '‚úì Copied!';
                        setTimeout(() => {
                            successSpan.textContent = '';
                        }, 2000);
                    }
                }).catch(err => {
                    alert('Failed to copy. Please select and copy manually.');
                });
            }
        }
    </script>
    <footer>
        <p>For more technical articles, visit <a href="https://gergovadasz.hu" target="_blank" rel="noopener noreferrer">gergovadasz.hu</a></p>
    </footer>
</body>
</html>
